<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="survey_question_form_inherit_extra" model="ir.ui.view">
        <field name="model">survey.question</field>
        <field name="inherit_id" ref="spc_survey.survey_question_form_inherit"/>
        <field name="arch" type="xml">



            <xpath expr="//label[@for='labels_adv_matrix_cols_ids']" position="before">

                <!-- Automating line filling from records  -->
                <group attrs="{ 'invisible' : [('type','!=','advanced_matrix')] }">
                    <group><field name="fill_auto"></field></group>
                    <group></group>
                </group>

                <group string="Automating lines filling" attrs="{'invisible':[('fill_auto','=',False)]}">
                    <group>
                        <field name="model_id" options="{'no_create': True, 'no_open': True}"/>
                        <field name="limit"/>
                        <field name="model_fields_ids" widget="many2many_tags" invisible="1"/>
                        <!--filter implementation-->
                        <field name="model_name" invisible="1"/>
                        <field name="filter_domain" widget="domain" options="{'model': 'model_name', 'in_dialog': True}"/>
                    </group>
                </group>
            </xpath>

            <field name="col_type_resp" position="after">
                <field name="model_id" attrs="{'invisible': [('col_type_resp', '!=', 'model')]}" options="{'no_create': True, 'no_open': True}" />
                <field name="model_filter_field_id"
                       attrs="{'invisible': [('col_type_resp', '!=', 'model')]}"
                       domain="[('id', 'in', model_filter_list_ids)]"
                       options="{'no_create_edit': True}"
                />
                <field name="equivalent_field_id" string="Equivalent"
                       attrs="{'invisible': [('col_type_resp', '!=', 'field_model')]}"
                       domain="[('id', 'in', parent.model_fields_ids)]"
                        />
                <field name="model_filter_list_ids" widget="many2many_tags" invisible="1"/>
            </field>

            <xpath expr="//label[@for='labels_adv_matrix_rows_ids']" position="attributes">
                <attribute name="attrs">{'invisible': ['|',('type', '!=', 'advanced_matrix'),('fill_auto','=',True)]}</attribute>
            </xpath>

            <field name="labels_adv_matrix_rows_ids" position="attributes">
                <attribute name="attrs">{'invisible': ['|',('type', '!=', 'advanced_matrix'),('fill_auto','=',True)]}</attribute>
            </field>


        </field>
    </record>


    <!-- smart question form inherit -->
    <record id="smart_survey_question_form_inherit_extra" model="ir.ui.view">
        <field name="model">survey.question</field>
        <field name="inherit_id" ref="spc_survey.inherit_smart_survey_question_form"/>
        <field name="arch" type="xml">

                <xpath expr="//label[@for='labels_adv_matrix_cols_ids']" position="before">

                    <!-- Automating line filling from records  -->
                    <group attrs="{ 'invisible' : [('type','!=','advanced_matrix')] }">
                        <group><field name="fill_auto"></field></group>
                        <group></group>
                    </group>

                    <group string="Automating lines filling" attrs="{'invisible':[('fill_auto','=',False)]}">
                        <group>
                            <field name="model_id" options="{'no_create': True, 'no_open': True}"/>
                            <field name="limit"/>
                            <field name="model_fields_ids" widget="many2many_tags" invisible="1"/>
                            <!--filter implementation-->
                            <field name="model_name" invisible="1"/>
                            <field name="filter_domain" widget="domain" options="{'model': 'model_name', 'in_dialog': True}"/>
                        </group>
                    </group>

                </xpath>

                <field name="col_type_resp" position="after">
                    <field name="model_id" attrs="{'invisible': [('col_type_resp', '!=', 'model')]}" options="{'no_create': True, 'no_open': True}" />
                    <field name="model_filter_field_id"
                       attrs="{'invisible': [('col_type_resp', '!=', 'model')]}"
                       domain="[('id', 'in', model_filter_list_ids)]"
                       options="{'no_create_edit': True}"
                    />
                    <field name="equivalent_field_id" string="Equivalent"
                           attrs="{'invisible': [('col_type_resp', '!=', 'field_model')]}"
                           domain="[('id', 'in', parent.model_fields_ids)]"
                            />
                    <field name="model_filter_list_ids" widget="many2many_tags" invisible="1"/>
                </field>

                <xpath expr="//label[@for='labels_adv_matrix_rows_ids']" position="attributes">
                    <attribute name="attrs">{'invisible': ['|',('type', '!=', 'advanced_matrix'),('fill_auto','=',True)]}</attribute>
                </xpath>

                <field name="labels_adv_matrix_rows_ids" position="attributes">
                    <attribute name="attrs">{'invisible': ['|',('type', '!=', 'advanced_matrix'),('fill_auto','=',True)]}</attribute>
                </field>

                <!-- add dropdown option field in rows -->
                <xpath expr="//field[@name='labels_adv_matrix_rows_ids']//tree//field[@name='value']" position="after">
                    <field name="row_dropdown_options" />
                    <field name="note_options" />
                    <field name="label" />
                </xpath>

                <xpath expr="//button[@icon='fa-columns']" position="attributes">
                    <attribute name="context">{'default_col_question_id': id, 'model_fields_ids': model_fields_ids}</attribute>
                </xpath>

                <!-- Add display smart button ; Add column calculation smart button-->
                <xpath expr="//div[@name='button_box']//button[2]" position="after">
                    <button class="oe_stat_button"
                            type="action"
                            name="%(spc_survey_extra.action_column_calculation)d"
                            icon="fa-columns"
                            string="Columns Dependencies"
                            context="{'default_question_id': id}">
                        <field name="id" invisible="1" />
                    </button>
                    <button class="oe_stat_button"
                            type="action"
                            name="%(spc_survey_extra.action_question_display)d"
                            icon="fa-tv"
                            string="Display"
                            context="{'default_question_id': id}">
                        <field name="id" invisible="1" />
                    </button>
                </xpath>



                <xpath expr="//field[@name='labels_adv_matrix_cols_ids']" position="after">
                    <group>
                        <field name="add_line_feature" />
                    </group>
                </xpath>

                <xpath expr="//field[@name='labels_adv_matrix_rows_ids']" position="after">

                    <separator />
			        <label for="detail" attrs="{'invisible': [('type', '!=', 'advanced_matrix')]}" />
				    <field name="detail" string="Details" widget="boolean" attrs="{'invisible': [('type', '!=', 'advanced_matrix')]}" />
				    <separator />
				    <label for="detail_labels_adv_matrix_cols_ids" attrs="{'invisible': [('detail', '=',False)]}" />
                    <field name="detail_labels_adv_matrix_cols_ids" string="Detail columns" context="{'detail_col_question_id': active_id}" attrs="{'invisible': [('detail', '=',False)] }">
                        <tree editable="bottom">
                            <field name="sequence" widget="handle"/>
                            <field name="value" string="Nom" required="1"/>
                            <field name="col_type_resp" string="Type" required="1"/>
                            <field name="model_id" attrs="{'invisible': [('col_type_resp', '!=', 'model')]}" options="{'no_create': True, 'no_open': True}" />
                            <field name="model_filter_field_id" attrs="{'invisible': [('col_type_resp', '!=', 'model')]}"
                                   domain="[('id', 'in', model_filter_list_ids)]" options="{'no_create_edit': True}"/>
                            <field name="equivalent_field_id" string="Equivalent"
                               attrs="{'invisible': [('col_type_resp', '!=', 'field_model')]}"
                               domain="[('id', 'in', parent.model_fields_ids)]"
                                />
                            <field name="model_filter_list_ids" widget="many2many_tags" invisible="1"/>
                            <field name="options" attrs="{'invisible': [('col_type_resp', '!=', 'dropdown')], 'required':[('col_type_resp', '=', 'dropdown')]}"/>
                            <field name="min"
                                   attrs="{'invisible': [('col_type_resp', 'not in', ['number','float_mumber'])]}"/>
                            <field name="max"
                                   attrs="{'invisible': [('col_type_resp', 'not in', ['number','float_mumber'])]}"/>
                            <field name="min_date" attrs="{'invisible': [('col_type_resp', 'not in', ['date'])]}" />
                            <field name="max_date" attrs="{'invisible': [('col_type_resp', 'not in', ['date'])]}" />
                            <field name="today" attrs="{'invisible': [('col_type_resp', 'not in', ['date'])]}" />
                        </tree>
                        <form>
                            <group>
                                <field name="value"/>
                                <field name="col_type_resp"/>
                            </group>
                        </form>
                    </field>
                    <field name="question_dependencies_ids" invisible="1"/>
                    <field name="question_display_ids" invisible="1"/>
                </xpath>

                <xpath expr="//notebook//page[1]" position="after">
                    <page string="Relation Question/Detail">

                        <group string="Question/Detail Relation">
                            <field name="question_detail_relation_ids" nolabel="1" attrs="{'invisible': [('detail', '=', False)]}">
                                <form>
                                    <group>
                                        <group>
                                            <field name="row_id" />
                                            <field name="condition" />
                                        </group>
                                        <group>
                                            <field name="details_nb_lines" />
                                        </group>
                                    </group>
                                </form>
                                <tree editable="bottom">
                                    <field name="row_id" required="1" domain="[('id','in',parent.labels_adv_matrix_rows_ids)]" options="{'no_create': True, 'no_create_edit':True}" context="{'tree_view_ref':'spc_survey_extra.survey_label_tree_for_display'}"/>
                                    <field name="condition" required="1"/>
                                    <field name="details_nb_lines" required="1" />
                                    <field name="question_id" invisible="1"/>
                                </tree>
                            </field>
                        </group>

                    </page>
                </xpath>

        </field>
    </record>

</odoo>
